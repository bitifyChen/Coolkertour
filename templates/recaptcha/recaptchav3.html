<script>
    if (typeof grecaptcha === 'undefined') {
        document.write('<script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_site_key }}"><\/script>');
    }
</script>
<input type="hidden" class="g-recaptcha-{{ action }}" name="g-recaptcha-response">
<script>
    document.addEventListener("DOMContentLoaded", function (event) {
        grecaptcha.ready(function () {
            grecaptcha.execute('{{ recaptcha_site_key }}', {action: '{{ action }}'}).then(function (token) {
                var inputs = document.getElementsByClassName("g-recaptcha-{{ action }}");
                Array.prototype.forEach.call(inputs, function (input, index) {
                    input.setAttribute('value', token);
                });
            });
        });
    });
</script>